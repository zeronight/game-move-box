(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1467:function(e,t,n){},1468:function(e,t,n){"use strict";n.r(t);var s={};n.r(s),n.d(s,"getSize",(function(){return u})),n.d(s,"getTile",(function(){return l})),n.d(s,"traverse",(function(){return d})),n.d(s,"clone",(function(){return h})),n.d(s,"find",(function(){return p})),n.d(s,"map",(function(){return f})),n.d(s,"filter",(function(){return y})),n.d(s,"reduce",(function(){return m}));var i=n(12),r=n.n(i);const o=window.devicePixelRatio||1,a=320*o,c=480*o;function u(e){return 0===e.length?0:e.length*e[0].length}function l(e,t,n){return void 0===e[n]?void 0:e[n][t]}function*d(e){for(let t=0;t<e.length;t+=1)for(let n=0;n<e[t].length;n+=1)yield{x:n,y:t,tile:e[t][n]}}function h(e,t=(e=>e.tile)){return e.map((e,n)=>e.map((e,s)=>t({x:s,y:n,tile:e})))}function p(e,t){for(const n of d(e))if(t(n))return n}function f(e,t){const n=[];for(const s of d(e))n.push(t(s));return n}function y(e,t){const n=[];for(const s of d(e))t(s)&&n.push(s);return n}function m(e,t,n){const s=d(e);let i=void 0!==n?n:s.next().value;for(const e of s)i=t(i,e);return i}let g,x;!function(e){e[e.Empty=0]="Empty",e[e.Wall=1]="Wall",e[e.Door=2]="Door",e[e.Box=3]="Box",e[e.Player=4]="Player",e[e.Dest=5]="Dest"}(g||(g={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down"}(x||(x={}));const{getSize:b,getTile:w,reduce:v,find:k,filter:S,clone:F}=s,D=[g.Wall,g.Door];g.Wall,g.Door,g.Dest,g.Empty;function I(e,t){return k(e,e=>t.includes(e.tile))}function L(e,t){return S(e,e=>t.includes(e.tile))}function T(e){return L(e,[g.Dest])}function O(e,t,n){const s=D.includes(w(e,t.x,t.y)),i=n.some(e=>e.x===t.x&&e.y===t.y);return s||i}function P(e,t){let n=e.x,s=e.y;switch(t){case x.Left:n-=1;break;case x.Right:n+=1;break;case x.Up:s-=1;break;case x.Down:s+=1}return{x:n,y:s,tile:e.tile}}function W(e,t,n){const s=O(e,t,n),i=function(e,t,n){const{x:s,y:i}=t;return[[s-1,i],[s+1,i],[s,i-1],[s,i+1]].some(([s,i])=>O(e,{x:s,y:i,tile:t.tile},n))}(e,t,n);return!s&&i}var G={key:"tile-shee",url:n.p+"images/tile-sheet.png",frameWidth:16,frameHeight:16,spacing:1,scale:1.5,frames:{empty:0,wall:416,door:325,box:227,player:153,dest:473}};const M=new Map([[g.Empty,G.frames.empty],[g.Wall,G.frames.wall],[g.Door,G.frames.door],[g.Box,G.frames.box],[g.Player,G.frames.player],[g.Dest,G.frames.dest]]);function A(e,t,n){const s=M.get(t.tile);s&&(e.setFrame(s),e.setScale(o*G.scale),e.setX(t.x*e.displayWidth+n.x),e.setY(t.y*e.displayHeight+n.y))}function z(e,t,n){e.children.iterate((e,s)=>{A(e,t[s],n)})}let C;!function(e){e[e.start=0]="start",e[e.end=1]="end",e[e.about=2]="about"}(C||(C={}));const H=new Map([[C.start,["有一天你卧病在床","而此刻你的女朋友已经梳妆打扮好","准备出门逛街","临行前，她吩咐你","在她晚上回家前把箱子搬到指定的位置","于是","你只能拄拐杖扶着墙","将箱子推到她满意的位置"]],[C.end,["恭喜你","成功将箱子推到了她满意的位置","赶紧躺下休息一下","然后去准备晚餐吧"]],[C.about,["基于 increpare.com 的小游戏移植，",{text:"访问原游戏。",link:"https://www.increpare.com/game/schleimban.html"}]]]);class K extends r.a.Scene{constructor(){super({key:"text"}),this.type=C.start}init(e){this.type=e.type}create(){const e=H.get(this.type);if(!e)return;const t=e.map(e=>{const t="string"!=typeof e,n=this.add.text(10*o,0,t?e.text:e,{fontFamily:"ipxi",fontSize:16*o,color:t?"rgb(122, 172, 208)":"#ffffff",padding:{left:8*o}});return t&&(n.setInteractive(),n.addListener("pointerup",()=>{location.href=e.link})),n}),n=this.add.group(t);n.setY(0,28*o),n.setVisible(!1);const s=this.add.text(a/2,c,"确定",{fontFamily:"ipxi",fontSize:20*o});s.setVisible(!1),s.setOrigin(.5,1),s.setInteractive(),s.addListener("pointerup",()=>{switch(this.type){case C.start:this.scene.start("game");break;case C.end:case C.about:this.scene.start("menu")}});const i=async(e=0)=>{const n=t[e];var r;n?(n.setVisible(!0),await(r=1e3,new Promise(e=>setTimeout(e,r))),i(e+1)):s.setVisible(!0)};i()}}var E={error:n.p+"fonts/error.mp3",move:n.p+"fonts/move.mp3",success:n.p+"fonts/success.mp3"},U=n.p+"fonts/ipxi.ttf";class R extends r.a.Scene{constructor(){super({key:"boot"})}preload(){this.load.spritesheet(G.key,G.url,{frameWidth:G.frameWidth,frameHeight:G.frameHeight,spacing:G.spacing}),this.load.audio("error",E.error),this.load.audio("move",E.move),this.load.audio("success",E.success),this.load.webfont("ipxi",U)}create(){this.scene.start("menu")}}function X(e){localStorage.setItem("level",String(e))}const Y=[{key:"newGame",text:"新游戏"},{key:"continue",text:"继续",condition:function(){return null!==localStorage.getItem("level")}},{key:"about",text:"关于"}];class B extends r.a.Scene{constructor(){super({key:"menu"}),this.currentMenuIndex=2}renderSelector(){const e=this.add.sprite(0,0,G.key);return e.setFrame(G.frames.player),e.setScale(o*G.scale*.8),e.setOrigin(1,.5),e}renderMenuList(e=0){const t=Y.filter(e=>!e.condition||e.condition()).map(t=>{const n=this.add.text(a/2,e,t.text,{fontFamily:"ipxi",fontSize:18*o,padding:{x:10*o,y:10*o}}).setOrigin(.5,0).setInteractive();return n.addListener("pointerup",()=>this.handleAction(t.key)),n}),n=this.add.group(t),[s,i]=t.reduce((e,t)=>[Math.max(e[0],t.displayWidth),Math.max(e[1],t.displayHeight)],[0,0]);return t.forEach(e=>e.setFixedSize(s,i)),n.setY(e,50*o),t}renderTitle(){const e=this.add.text(a/2,0,"推箱子",{fontFamily:"ipxi",fontSize:52*o});return e.setOrigin(.5,0),e}handleAction(e){switch(e){case"newGame":X(0),this.scene.start("text",{type:C.start});break;case"continue":this.scene.start("game");break;case"about":this.scene.start("text",{type:C.about})}}create(){const e=this.renderTitle();this.renderMenuList(e.displayHeight+100*o)}}var N=[[[0,0,1,1,1,1,1,0,0],[0,0,1,0,0,0,1,0,0],[0,0,1,0,5,0,1,0,0],[0,0,1,0,0,0,1,0,0],[1,1,1,1,0,1,1,1,1],[1,0,0,0,0,0,0,0,1],[1,0,0,0,3,0,0,0,1],[1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,1],[1,0,0,0,4,0,0,0,1],[1,1,1,1,2,1,1,1,1]],[[0,0,1,1,1,1,0,0,0],[1,1,1,0,0,1,1,1,1],[1,0,0,0,0,0,3,0,1],[1,0,1,0,0,1,3,0,1],[1,0,5,0,5,1,4,0,1],[1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,1],[1,0,0,5,0,5,0,0,1],[1,0,0,0,0,0,0,0,1],[1,1,0,1,1,1,0,1,1],[1,0,0,0,0,0,0,0,1],[1,0,3,0,4,0,3,0,1],[1,0,0,0,1,0,0,0,1],[1,1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1],[1,5,0,0,0,0,0,1],[1,4,3,3,0,0,0,1],[1,1,0,0,0,0,0,1],[0,1,1,0,0,0,0,1],[0,0,1,1,0,0,0,1],[0,0,0,1,1,0,0,1],[0,0,0,0,1,1,5,1],[0,0,0,0,0,1,1,1]],[[1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,1,1],[1,0,0,3,3,0,5,5,1],[1,0,0,0,0,1,1,1,1],[1,0,4,0,0,1,0,0,0],[1,1,1,1,1,1,0,0,0]]];const V=new Map([[r.a.Input.Keyboard.KeyCodes.LEFT,x.Left],[r.a.Input.Keyboard.KeyCodes.RIGHT,x.Right],[r.a.Input.Keyboard.KeyCodes.UP,x.Up],[r.a.Input.Keyboard.KeyCodes.DOWN,x.Down]]);class j extends r.a.Scene{constructor(){super({key:"game"}),this.level=0,this.room=N[0],this.offset={x:0,y:0},this.route=[]}init(){this.level=Math.min(N.length-1,function(){const e=Number(localStorage.getItem("level"));return Object.is(e,NaN)?0:e}()),this.room=N[this.level],this.offset=function(e,t){const n=G.frameWidth*G.scale,s=G.frameHeight*G.scale;return{x:(320-e*n+n)/2*o,y:(480-t*s+s)/2*o}}(this.room[0].length,this.room.length),this.components=void 0,this.route=[]}renderSingleSprite(e){const t=this.add.sprite(0,0,G.key);return A(t,e,this.offset),t}renderGroupSprite(e){const t=this.add.group(void 0,{classType:r.a.GameObjects.Sprite,key:G.key,frame:G.frames.empty,repeat:e.length-1,setXY:{x:0,y:0}});return z(t,e,this.offset),t}renderDest(e){const t=this.renderGroupSprite(e);return this.tweens.add({targets:t.children.getArray(),scale:o*G.scale*.9,alpha:.8,duration:600,repeat:1/0,ease:"Quad.easeInOut",yoyo:!0}),t}renderTitle(){const e=`第 ${this.level+1} 关`,t=this.add.rectangle(0,0,a,c,3942965);t.setOrigin(0,0);const n=this.add.text(a/2,c/2,e,{fontFamily:"ipxi",fontSize:14*o,align:"center"});n.setOrigin(.5),setTimeout(()=>{n.destroy(),this.tweens.add({targets:t,alpha:0,duration:1e3})},1e3)}updateUI(){const{components:e,route:t,offset:n}=this,s=t[0];e&&s&&(A(e.player,s.player,n),z(e.boxes,s.boxes,n))}setState(e){this.route=e,this.updateUI()}preload(){this.load.spritesheet(G.key,G.url,{frameWidth:G.frameWidth,frameHeight:G.frameHeight,spacing:G.spacing}),this.load.audio("error",E.error),this.load.audio("move",E.move),this.load.audio("success",E.success)}move(e){const{room:t,route:n}=this,s=n[0];if(!s)return;const i=T(t),r=function(e,t,n){const s=P(t.player,n),i=t.boxes.findIndex(e=>e.x===s.x&&e.y===s.y);if(i<0){return W(e,s,t.boxes)?{player:s,boxes:t.boxes}:t}const r=P(t.boxes[i],n);if(!W(e,r,t.boxes))return t;const o=[...t.boxes];return o[i]=r,{player:s,boxes:o}}(t,s,e);r!==s?(this.setState([r,...n]),function(e,t){return e.every(e=>t.some(t=>t.x===e.x&&t.y===e.y))}(r.boxes,i)?requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.sound.play("success"),this.level<N.length-1?(X(this.level+1),this.scene.restart()):this.scene.start("text",{type:C.end})})}):this.sound.play("move")):this.sound.play("error")}undo(){const e=[...this.route];e.length<2||(e.shift(),this.setState(e))}renderActions(){const e=new Map([["主菜单",()=>this.scene.start("menu")],["重新开始",()=>this.scene.restart()],["回退",()=>this.undo()]]),t=[...e.keys()].map(t=>{const n=this.add.text(0,0,t,{fontFamily:"ipxi",fontSize:14*o,padding:{x:20*o,y:10*o}});return n.setInteractive(),n.setOrigin(0,0),n.addListener("pointerup",e.get(t)),n});t[0].setX(0),t[1].setX(a/2),t[1].setOrigin(.5,0),t[2].setX(a),t[2].setOrigin(1,0)}create(){const{room:e}=this,t=function(e){return I(e,[g.Player])}(e),n=function(e){return L(e,[g.Box])}(e),s=T(e),i=function(e){return L(e,D)}(e);if(!t)return;this.renderGroupSprite(i),this.renderDest(s);const o=this.renderGroupSprite(n),a=this.renderSingleSprite(t);this.renderActions(),this.renderTitle(),this.components={player:a,boxes:o},this.route.unshift({player:t,boxes:n}),this.input.on("pointerup",e=>{const t=e.upTime-e.downTime,n=new r.a.Geom.Point(e.upX-e.downX,e.upY-e.downY),s=r.a.Geom.Point.GetMagnitude(n),i=new r.a.Geom.Point(n.x/s,n.y/s);s>20&&t<1e3&&(Math.abs(i.x)>.8||Math.abs(i.y)>.8)&&(i.x>.8?this.move(x.Right):i.x<-.8?this.move(x.Left):i.y>.8?this.move(x.Down):this.move(x.Up))}),this.input.keyboard.on("keydown",e=>{if(e.keyCode===r.a.Input.Keyboard.KeyCodes.Z)return void this.undo();const t=V.get(e.keyCode);void 0!==t&&this.move(t)})}}n(1467);const{FILE_POPULATED:q}=r.a.Loader;class J extends r.a.Loader.File{constructor(e,t,n){super(e,{key:t,url:n,type:"webfont"})}load(){if(this.state===q)this.loader.nextFile(this,!0);else{const e=new FontFace(this.key,`url(${this.url})`);e.load().then(()=>{document.fonts.add(e),this.loader.nextFile(this,!0)},()=>{this.loader.nextFile(this,!1)})}}onLoad(){this.loader.nextFile(this,!0)}onError(){this.loader.nextFile(this,!1)}}function $(e,t){this.addFile(new J(this,e,t))}class Q extends i.Plugins.BasePlugin{constructor(e){super(e),e.registerFileType("webfont",$)}}document.body.style.backgroundColor="#"+3942965..toString(16),new r.a.Game({type:r.a.CANVAS,width:a,height:c,resolution:2,zoom:1/o,backgroundColor:3942965,scene:[R,B,K,j],parent:"game",render:{pixelArt:!0},plugins:{global:[{key:"webFontLoader",plugin:Q,start:!0}]}})}},[[1468,1,2]]]);